webpackJsonp([2],{236:function(t,e,i){"use strict";t.exports=function(t){var e=i(182),n=i(3);if(e.getUserRole()===Enums.UserRole.SuperAdmin){var s=i(2),r=i(185),a=i(237),o=i(238),u=[],h=[],c=[],E=[];return o.init(t),a.init(t),{start:function(){c.push({GetTabView:function(t){i.e(1,function(){t(i(247))})},TabName:o.HashModuleName+"-db",TabTitle:r.i18n("ADMINPANELWEBCLIENT/LABEL_DB_SETTINGS_TAB")}),c.push({GetTabView:function(t){i.e(1,function(){t(i(249))})},TabName:o.HashModuleName+"-security",TabTitle:r.i18n("ADMINPANELWEBCLIENT/LABEL_SECURITY_SETTINGS_TAB")}),c.push({GetTabView:function(t){i.e(1,function(){t(i(250))})},TabName:"common",TabTitle:r.i18n("ADMINPANELWEBCLIENT/LABEL_COMMON_SETTINGS_TAB")}),c.push({GetTabView:function(t){i.e(1,function(){t(i(251))})},TabName:"about",TabTitle:r.i18n("ADMINPANELWEBCLIENT/LABEL_ABOUT_SETTINGS_TAB")})},getScreens:function(){var t={};return t[o.HashModuleName]=function(){return new n(function(t,e){i.e(1,function(e){var r=i(241);s.each(u,function(t){r.registerEntityType(t)}),s.each(h,function(t){r.changeEntityData(t)});var a=i(244),o=[];s.each(c,function(t){var e=a.registerTab(t.GetTabView,t.TabName,t.TabTitle);e&&o.push(e)}),n.all(o).then(function(){a.sortRegisterTabs(),t(a),s.each(E,function(t){a.registerTabSection(t.GetTabView,t.TabName,t.TabTitle)})},function(){a.sortRegisterTabs(),t(a),s.each(E,function(t){a.registerTabSection(t.GetTabView,t.TabName,t.TabTitle)})})})})},t},getAbstractSettingsFormViewClass:function(){return i(239)},registerAdminPanelTab:function(t,e,i){c.push({GetTabView:t,TabName:e,TabTitle:i})},registerAdminPanelTabSection:function(t,e){E.push({GetTabView:t,TabName:e})},showEntities:function(t,e){var n=i(195),s=i(240);n.setHash(s.get(t,e,""))},setAddHash:function(t){var e=i(244);e.setAddHash(t)},registerAdminPanelEntityType:function(t){u.push(t)},changeAdminPanelEntityData:function(t){h.push(t)},getKoSelectedTenantId:function(){return a.selectedTenantId},getTenantsObservable:function(){return a.tenants}}}return null}},237:function(t,e,i){"use strict";function n(){this.tenants=r.observableArray([]),this.selectedTenantId=r.observable(0),this.selectedTenant=r.computed(function(){return s.find(this.tenants(),function(t){return t.Id===this.selectedTenantId()}.bind(this))||{Name:""}},this),h.dbSettingsChanged.subscribe(function(){h.dbSettingsChanged()&&o.send(c.ServerModuleName,"GetEntityList",{Type:"Tenant"})})}var s=i(2),r=i(44),a=i(181),o=i(191),u=i(182),h=i(43),c=i(238);n.prototype.init=function(t){u.subscribeEvent("ReceiveAjaxResponse::after",this.onAjaxResponse.bind(this));var e=t[c.ServerModuleName];this.parseTenants(e?e.Tenants:[])},n.prototype.onAjaxResponse=function(t){if(t.Response.Module===c.ServerModuleName&&"GetEntityList"===t.Response.Method&&"Tenant"===t.Request.Parameters.Type){var e=a.pString(t.Request.Parameters.Search),i=a.pInt(t.Request.Parameters.Offset);""===e&&0===i&&this.parseTenants(t.Response.Result)}},n.prototype.setSelectedTenant=function(t){s.find(this.tenants(),function(e){return e.Id===t})&&this.selectedTenantId(t)},n.prototype.parseTenants=function(t){var e=this.selectedTenantId(),i=!1,n=t&&s.isArray(t.Items)?t.Items:[],r=[];s.each(n,function(t){var n={Name:t.Name,Id:a.pInt(t.Id)};n.Id===e&&(i=!0),r.push(n)}),i||this.selectedTenantId(r.length>0?r[0].Id:0),this.tenants(r)},t.exports=new n},238:function(t,e,i){"use strict";var n=i(2),s=i(181);t.exports={ServerModuleName:"AdminPanelWebclient",HashModuleName:"admin",EntitiesPerPage:20,TabsOrder:["licensing","admin-security","admin-db","logs-viewer","system","common","modules"],EntitiesOrder:[],EnableMultiTenant:!1,init:function(t){var e=t[this.ServerModuleName],i=t.Core;n.isEmpty(e)||(this.EntitiesPerPage=s.pPositiveInt(e.EntitiesPerPage,this.EntitiesPerPage),this.TabsOrder=s.pArray(e.TabsOrder,this.TabsOrder),this.EntitiesOrder=s.pArray(e.EntitiesOrder,this.EntitiesOrder)),n.isEmpty(i)||(this.EnableMultiTenant=s.pBool(i.EnableMultiTenant,this.EnableMultiTenant))}}},239:function(t,e,i){"use strict";function n(t){this.sServerModule=t?t:"Core",this.isSaving=r.observable(!1),this.visible=r.observable(!0),this.sSavedState="",this.bShown=!1,this.aSettingsSections=[]}var s=i(2),r=i(44),a=i(185),o=i(191),u=i(186),h=i(188),c=i(192),E=i(201);n.prototype.ViewTemplate="",n.prototype.addSettingsSection=function(t){this.aSettingsSections.push(t)},n.prototype.onRoute=function(t){var e=!this.bShown;this.bShown=!0,e&&s.isFunction(this.onShow)&&this.onShow(),this.revert(),s.isFunction(this.onRouteChild)&&this.onRouteChild(t),s.each(this.aSettingsSections,function(e){s.isFunction(e.onShow)&&e.onShow(t)})},n.prototype.hide=function(t,e){var i=this.getCurrentState()!==this.sSavedState;s.each(this.aSettingsSections,function(t){s.isFunction(t.getCurrentState)&&(i=i||t.getCurrentState()!==t.sSavedState)}),i?c.showPopup(E,[a.i18n("COREWEBCLIENT/CONFIRM_DISCARD_CHANGES"),s.bind(function(i){i?(this.bShown=!1,t(),this.revert()):s.isFunction(e)&&e()},this)]):(this.bShown=!1,t())},n.prototype.getCurrentValues=function(){return[]},n.prototype.getCurrentState=function(){var t=this.getCurrentValues();return t.join(":")},n.prototype.updateSavedState=function(){this.sSavedState=this.getCurrentState()},n.prototype.revertGlobalValues=function(){},n.prototype.revert=function(){s.each(this.aSettingsSections,function(t){s.isFunction(t.revert)&&t.revert()}),this.revertGlobalValues(),this.updateSavedState()},n.prototype.getParametersForSave=function(){return{}},n.prototype.save=function(){s.isFunction(this.validateBeforeSave)&&!this.validateBeforeSave()||(this.isSaving(!0),o.send(this.sServerModule,"UpdateSettings",this.getParametersForSave(),this.onResponse,this))},n.prototype.applySavedValues=function(t){},n.prototype.onResponse=function(t,e){if(this.isSaving(!1),t.Result){var i=e.Parameters;this.updateSavedState(),this.applySavedValues(i),h.showReport(a.i18n("COREWEBCLIENT/REPORT_SETTINGS_UPDATE_SUCCESS"))}else u.showErrorByCode(t,a.i18n("COREWEBCLIENT/ERROR_SAVING_SETTINGS_FAILED"))},n.prototype.setAccessLevel=function(t,e){},t.exports=n},240:function(t,e,i){"use strict";function n(t){return c===t.substr(0,1)&&/^[1-9][\d]*$/.test(t.substr(c.length))}function s(t){return h===t.substr(0,h.length)}var r=i(2),a=i(181),o=i(241),u=i(238),h="s.",c="p.",E={};E.get=function(t,e,i,n,s){var E=[u.HashModuleName],l=!0;return e=e||[],r.each(o.getData(),function(i){l&&(a.isPositiveNumber(e[i.Type])?"User"===i.Type&&"MailingList"===t||E.push(i.ScreenHash.substr(0,1)+e[i.Type]):t===i.Type&&E.push(i.ScreenHash),t===i.Type&&(l=!1))}),a.isPositiveNumber(n)&&n>1&&E.push(c+n),a.isNonEmptyString(s)&&E.push(h+s),a.isNonEmptyString(i)&&E.push(i),E},E.parse=function(t){var e=0,i={},u="",E=1,l="",p="";return r.each(o.getData(),function(r){t[e]&&r.ScreenHash===t[e]&&(u=r.Type,e++),t[e]&&r.ScreenHash.substr(0,1)===t[e].substr(0,1)&&a.pInt(t[e].substr(1))>0&&(i[r.Type]=a.pInt(t[e].substr(1)),u=r.Type,e++),t.length>e&&(p=a.pString(t[e]),n(p)&&(E=a.pInt(p.substr(c.length)),E<=0&&(E=1),e++)),t.length>e&&(p=a.pString(t[e]),s(p)&&(l=p.substr(h.length),e++))}),{Entities:i,CurrentType:u,Last:a.isNonEmptyString(t[e])?t[e]:"",Page:E,Search:l}},t.exports=E},241:function(t,e,i){"use strict";function n(){this.aData=[],a.EnableMultiTenant&&this.aData.push({Type:"Tenant",ScreenHash:"tenants",LinkTextKey:"ADMINPANELWEBCLIENT/HEADING_TENANTS_SETTINGS_TABNAME",EditView:i(242),ServerModuleName:a.ServerModuleName,GetListRequest:"GetEntityList",GetRequest:"GetEntity",CreateRequest:"CreateTenant",UpdateRequest:"UpdateEntity",DeleteRequest:"DeleteEntities",NoEntitiesFoundText:r.i18n("ADMINPANELWEBCLIENT/INFO_NO_ENTITIES_FOUND_TENANT"),ActionCreateText:r.i18n("ADMINPANELWEBCLIENT/ACTION_CREATE_ENTITY_TENANT"),ReportSuccessCreateText:r.i18n("ADMINPANELWEBCLIENT/REPORT_CREATE_ENTITY_TENANT"),ErrorCreateText:r.i18n("ADMINPANELWEBCLIENT/ERROR_CREATE_ENTITY_TENANT"),CommonSettingsHeadingText:r.i18n("COREWEBCLIENT/HEADING_COMMON_SETTINGS"),ReportSuccessUpdate:r.i18n("ADMINPANELWEBCLIENT/REPORT_UPDATE_ENTITY_TENANT"),ErrorUpdate:r.i18n("ADMINPANELWEBCLIENT/ERROR_UPDATE_ENTITY_TENANT"),ActionDeleteText:r.i18n("ADMINPANELWEBCLIENT/ACTION_DELETE_TENANT"),ConfirmDeleteLangConst:"ADMINPANELWEBCLIENT/CONFIRM_DELETE_TENANT_PLURAL",ReportSuccessDeleteLangConst:"ADMINPANELWEBCLIENT/REPORT_DELETE_ENTITIES_TENANT_PLURAL",ErrorDeleteLangConst:"ADMINPANELWEBCLIENT/ERROR_DELETE_ENTITIES_TENANT_PLURAL"}),this.aData.push({Type:"User",ScreenHash:"users",LinkTextKey:"ADMINPANELWEBCLIENT/HEADING_USERS_SETTINGS_TABNAME",EditView:i(243),ServerModuleName:a.ServerModuleName,GetListRequest:"GetEntityList",GetRequest:"GetEntity",CreateRequest:"CreateUser",UpdateRequest:"UpdateEntity",DeleteRequest:"DeleteEntities",NoEntitiesFoundText:r.i18n("ADMINPANELWEBCLIENT/INFO_NO_ENTITIES_FOUND_USER"),ActionCreateText:r.i18n("ADMINPANELWEBCLIENT/ACTION_CREATE_ENTITY_USER"),ReportSuccessCreateText:r.i18n("ADMINPANELWEBCLIENT/REPORT_CREATE_ENTITY_USER"),ErrorCreateText:r.i18n("ADMINPANELWEBCLIENT/ERROR_CREATE_ENTITY_USER"),CommonSettingsHeadingText:r.i18n("COREWEBCLIENT/HEADING_COMMON_SETTINGS"),ReportSuccessUpdate:r.i18n("ADMINPANELWEBCLIENT/REPORT_UPDATE_ENTITY_USER"),ErrorUpdate:r.i18n("ADMINPANELWEBCLIENT/ERROR_UPDATE_ENTITY_USER"),ActionDeleteText:r.i18n("ADMINPANELWEBCLIENT/ACTION_DELETE_USER"),ConfirmDeleteLangConst:"ADMINPANELWEBCLIENT/CONFIRM_DELETE_USER_PLURAL",ReportSuccessDeleteLangConst:"ADMINPANELWEBCLIENT/REPORT_DELETE_ENTITIES_USER_PLURAL",ErrorDeleteLangConst:"ADMINPANELWEBCLIENT/ERROR_DELETE_ENTITIES_USER_PLURAL"}),this.sortEntitiesData()}var s=i(2),r=i(185),a=i(238);n.prototype.getData=function(){return this.aData},n.prototype.getEntityData=function(t){return s.find(this.aData,function(e){return e.Type===t})},n.prototype.getEditView=function(t){var e=this.getEntityData(t);return e?e.EditView:null},n.prototype.registerEntityType=function(t){this.aData.push(t),this.sortEntitiesData()},n.prototype.sortEntitiesData=function(){this.aData=s.sortBy(this.aData,function(t){var e=s.indexOf(a.EntitiesOrder,t.Type);return e!==-1?e:a.EntitiesOrder.length})},n.prototype.changeEntityData=function(t){var e=this.getEntityData(t.Type);e&&s.each(t,function(t,i){e[i]=t})},t.exports=new n},242:function(t,e,i){(function(e){"use strict";function n(t){var e=u.pArray(window.auroraAppData&&window.auroraAppData.additional_entity_fields_to_edit);return r.filter(e,function(e){return e.value=a.observable(""),e.Entity===t})}function s(){this.id=a.observable(0),this.name=a.observable(""),this.description=a.observable(""),this.webDomain=a.observable(""),this.siteName=a.observable(""),this.sHeading=o.i18n("ADMINPANELWEBCLIENT/HEADING_CREATE_TENANT"),this.sActionCreate=o.i18n("COREWEBCLIENT/ACTION_CREATE"),this.sActionCreateInProgress=o.i18n("COREWEBCLIENT/ACTION_CREATE_IN_PROGRESS"),this.aAdditionalFields=n("Tenant")}var r=i(2),a=i(44),o=i(185),u=i(181),h=i(188);s.prototype.ViewTemplate="AdminPanelWebclient_EditTenantView",s.prototype.getCurrentValues=function(){var t=[this.id(),this.name(),this.description(),this.webDomain(),this.siteName()];return r.each(this.aAdditionalFields,function(e){t.push(e.value())}),t},s.prototype.clearFields=function(){this.id(0),this.name(""),this.description(""),this.webDomain(""),this.siteName(""),r.each(this.aAdditionalFields,function(t){t.value("")})},s.prototype.parse=function(t,e){e?(this.id(t),this.name(e.Name),this.description(e.Description),this.webDomain(e.WebDomain),this.siteName(e.SiteName),r.each(this.aAdditionalFields,function(t){t.value(u.pString(e[t.FieldName]))})):this.clearFields()},s.prototype.isValidSaveData=function(){return""===e.trim(this.name())?(h.showError(o.i18n("ADMINPANELWEBCLIENT/ERROR_TENANT_NAME_EMPTY")),!1):!/[\\\/\:\*\?\\\"\<\>\|]/gi.test(this.name())||(h.showError(o.i18n("ADMINPANELWEBCLIENT/ERROR_TENANT_NAME_INVALID")),!1)},s.prototype.getParametersForSave=function(){var t={Id:this.id(),Name:this.name(),Description:this.description(),WebDomain:this.webDomain(),SiteName:this.siteName()};return r.each(this.aAdditionalFields,function(e){t[e.FieldName]=e.value()}),t},t.exports=new s}).call(e,i(1))},243:function(t,e,i){"use strict";function n(){this.id=a.observable(0),this.publicId=a.observable(""),this.aRoles=[{text:o.i18n("ADMINPANELWEBCLIENT/LABEL_ADMINISTRATOR"),value:Enums.UserRole.SuperAdmin},{text:o.i18n("ADMINPANELWEBCLIENT/LABEL_USER"),value:Enums.UserRole.NormalUser},{text:o.i18n("ADMINPANELWEBCLIENT/LABEL_GUEST"),value:Enums.UserRole.Customer}],this.role=a.observable(Enums.UserRole.NormalUser),this.writeSeparateLog=a.observable(!1),this.sHeading=o.i18n("ADMINPANELWEBCLIENT/HEADING_CREATE_USER"),this.sActionCreate=o.i18n("COREWEBCLIENT/ACTION_CREATE"),this.sActionCreateInProgress=o.i18n("COREWEBCLIENT/ACTION_CREATE_IN_PROGRESS"),h.broadcastEvent("AdminPanelWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var s=i(2),r=i(1),a=i(44),o=i(185),u=i(188),h=i(182);n.prototype.ViewTemplate="AdminPanelWebclient_EditUserView",n.prototype.ViewConstructorName="CEditUserView",n.prototype.getCurrentValues=function(){return[this.id(),this.publicId(),this.role(),this.writeSeparateLog()]},n.prototype.clearFields=function(){this.id(0),this.publicId(""),this.role(Enums.UserRole.NormalUser),this.writeSeparateLog(!1)},n.prototype.parse=function(t,e){e?(this.id(t),this.publicId(e.PublicId),this.role(e.Role),this.writeSeparateLog(!!e.WriteSeparateLog)):this.clearFields()},n.prototype.isValidSaveData=function(){var t=""!==r.trim(this.publicId());return t||u.showError(o.i18n("ADMINPANELWEBCLIENT/ERROR_USER_NAME_EMPTY")),t},n.prototype.getParametersForSave=function(){return{Id:this.id(),PublicId:r.trim(this.publicId()),Role:this.role(),WriteSeparateLog:this.writeSeparateLog()}},n.prototype.saveEntity=function(t,e){s.each(t,function(t){"CEntitiesView"===t.constructor.name&&s.isFunction(t.createEntity)&&t.createEntity(),"CCommonSettingsPaneView"===t.constructor.name&&s.isFunction(t.save)&&t.save(e)})},t.exports=new n},244:function(t,e,i){"use strict";function n(){p.call(this,"AdminPanelWebclient"),this.tenants=T.tenants,this.selectedTenant=T.selectedTenant,this.currentEntityType=a.observable(""),this.currentEntitiesId=a.observable({}),this.lastSavedEntitiesId=a.observable({}),this.showTenantsSelector=a.computed(function(){return N.EnableMultiTenant&&this.tenants().length>1},this),this.aScreens=[{linkHash:a.observable(l.buildHashFromArray(d.get(""))),sLinkText:u.i18n("ADMINPANELWEBCLIENT/HEADING_SYSTEM_SETTINGS_TABNAME"),sType:"",oView:null}],s.each(y.getData(),s.bind(function(t){var e=new f(t.Type),i=s.bind(function(t,e,i){if("create"===i)this.createEntity();else if(t===this.currentEntityType())this.changeEntity(t,e,i||"");else{var n=s.clone(this.currentEntitiesId());h.isNumber(e)?t&&(n[t]=e,delete n[this.currentEntityType()]):n[t]&&delete n[t],l.replaceHash(d.get(this.currentEntityType(),n,""))}},this);e.setChangeEntityHandler(i),this.aScreens.push({linkHash:a.computed(function(){var e=s.clone(this.lastSavedEntitiesId());return s.extend(e,this.currentEntitiesId()),l.buildHashFromArray(d.get(t.Type,e))},this),sLinkText:u.i18n(t.LinkTextKey),sType:t.Type,oView:e})},this)),this.currentEntitiesView=a.computed(function(){var t=this.currentEntityType(),e=s.find(this.aScreens,function(e){return e.sType===t});return e?e.oView:null},this),this.currentEntitiesView.subscribe(function(){this.currentEntitiesView()&&this.currentEntitiesView().onHide()},this,"beforeChange"),this.currentEntitiesView.subscribe(function(){this.currentEntitiesView()&&this.currentEntitiesView().onShow()},this),this.tabs=a.observableArray([]),this.visibleTabsCount=a.computed(function(){var t=0;return s.each(this.tabs(),function(e){e.view&&(void 0===e.view.visible||e.view.visible())&&t++}),t},this),this.showModulesTabs=a.computed(function(){return""===this.currentEntityType()||this.currentEntitiesView().hasSelectedEntity()},this),this.currentTab=a.observable(null),this.aStartErrors=[],c.subscribeEvent("SendAjaxRequest::before",this.onAjaxSend.bind(this)),c.broadcastEvent("AdminPanelWebclient::ConstructView::after",{Name:this.ViewConstructorName,View:this})}var s=i(2),r=i(1),a=i(44),o=i(3),u=i(185),h=i(181),c=i(182),E=i(188),l=i(195),p=i(198),d=i(240),T=i(237),y=i(241),N=i(238),f=i(245);s.extendOwn(n.prototype,p.prototype),n.prototype.ViewTemplate="AdminPanelWebclient_SettingsView",n.prototype.ViewConstructorName="CSettingsView",n.prototype.onAjaxSend=function(t){""===this.currentEntityType()||t.Parameters.TenantId||(t.Parameters.TenantId=T.selectedTenantId())},n.prototype.selectTenant=function(t){var e=s.clone(this.currentEntitiesId());e.Tenant=t,l.setHash(d.get(this.currentEntityType(),e))},n.prototype.registerTab=function(t,e,i){if(s.isFunction(t)){var n=this.tabs;return new o(t).then(function(t){n.push({view:t,name:e,title:i})},function(t){})}return!1},n.prototype.sortRegisterTabs=function(){this.tabs(s.sortBy(this.tabs(),function(t){var e=s.indexOf(N.TabsOrder,t.name);return e!==-1?e:N.TabsOrder.length}))},n.prototype.registerTabSection=function(t,e){var i=s.findWhere(this.tabs(),{name:e}),n=t();i&&i.view.addSettingsSection(n)},n.prototype.cancelCreatingEntity=function(){l.setHash(d.get(this.currentEntityType(),this.currentEntitiesId(),""))},n.prototype.createEntity=function(){var t=s.clone(this.currentEntitiesId());delete t[this.currentEntityType()],"Tenant"!==this.currentEntityType()&&!t.Tenant&&T.selectedTenantId()&&(t.Tenant=T.selectedTenantId()),l.setHash(d.get(this.currentEntityType(),t,"create"))},n.prototype.changeEntity=function(t,e,i){var n=s.clone(this.currentEntitiesId()),r=!!s.find(this.tabs(),function(t){return t.name===i}),a=this.currentTab()?this.currentTab().name:"";t&&(n[t]=e),"Tenant"!==t&&T.selectedTenantId()&&(n.Tenant=T.selectedTenantId()),l.setHash(d.get(t,n,r?i:a))},n.prototype.onBind=function(){s.each(this.tabs(),s.bind(function(t){if(t.view&&s.isFunction(t.view.getStartError)){var e=t.view.getStartError();s.isFunction(e)&&(e.subscribe(function(){this.showStartError()},this),this.aStartErrors.push(e))}},this)),this.showStartError()},n.prototype.showStartError=function(){var t=[];s.each(this.aStartErrors,function(e){var i=e();""!==i&&t.push(i)}),E.showError(t.join("<br /><br />"),!0)},n.prototype.onRoute=function(t){var e=d.parse(t),i=t.slice(1),n=this.currentEntityType()===e.CurrentType,a=this.currentEntitiesId()[e.CurrentType]===e.Entities[e.CurrentType],o=this.currentTab()&&this.currentTab().name===e.Last,u=JSON.stringify(this.currentEntitiesId())===JSON.stringify(e.Entities),h=this.currentTab(),c=s.bind(function(){this.showNewScreenView(e),this.showNewTabView(e.Last,i)},this),E=s.bind(function(){h&&l.replaceHashDirectly(d.get(this.currentEntityType(),this.currentEntitiesId(),this.currentTab()?this.currentTab().name:""))},this);n&&a&&o&&u?h&&h.view.onRoute(i,this.currentEntitiesId()):h&&r.isFunction(h.view.hide)?h.view.hide(c,E):c()},n.prototype.showNewScreenView=function(t){var e=s.find(this.aScreens,function(e){return e.sType===t.CurrentType});this.currentEntityType(t.CurrentType),this.currentEntitiesId(t.Entities),s.isEmpty(t.Entities)||this.lastSavedEntitiesId(t.Entities),T.setSelectedTenant(t.Entities.Tenant),e&&e.oView&&("create"===t.Last?e.oView.openCreateForm():e.oView.cancelCreatingEntity(),e.oView.changeEntity(t.Entities[t.CurrentType],t.Entities))},n.prototype.showNewTabView=function(t,e){s.each(this.tabs(),s.bind(function(t){t.view&&s.isFunction(t.view.setAccessLevel)&&t.view.setAccessLevel(this.currentEntityType(),this.currentEntitiesId()[this.currentEntityType()])},this));var i=s.find(this.tabs(),function(e){return e.name===t});i&&i.view&&i.view.visible()||(i=s.find(this.tabs(),function(t){return t.view&&t.view.visible()})),i&&(r.isFunction(i.view.onRoute)&&i.view.onRoute(e,this.currentEntitiesId()),this.currentTab(i))},n.prototype.changeTab=function(t){var e=this.currentEntityType()?this.currentEntitiesId():{};l.setHash(d.get(this.currentEntityType(),e,t))},n.prototype.logout=function(){c.logout()},n.prototype.deleteCurrentEntity=function(){this.currentEntitiesView()&&this.currentEntitiesView().deleteCurrentEntity()},n.prototype.setAddHash=function(t){l.setHash(s.union([N.HashModuleName,this.currentTab()?this.currentTab().name:""],t))},t.exports=new n},245:function(t,e,i){"use strict";function n(t){T.selectedTenantId.subscribe(function(){"Tenant"!==this.sType&&this.requestEntities()},this),this.sType=t,this.oEntityCreateView=y.getEditView(this.sType),this.oEntityData=y.getEntityData(this.sType),this.sActionCreateText=this.oEntityData.ActionCreateText,this.sNoEntitiesFoundText=this.oEntityData.NoEntitiesFoundText,this.entities=r.observableArray([]),this.aFilters=[],this.initFilters(),this.totalEntitiesCount=r.observable(0),this.current=r.observable(0),this.showCreateForm=r.observable(!1),this.isCreating=r.observable(!1),this.hasSelectedEntity=r.computed(function(){var t=s.map(this.entities(),function(t){return t.Id});return s.indexOf(t,this.current())!==-1},this),this.justCreatedId=r.observable(0),this.fChangeEntityHandler=function(){},r.computed(function(){0===this.justCreatedId()&&!this.showCreateForm()&&!this.hasSelectedEntity()&&this.entities().length>0&&this.fChangeEntityHandler(this.sType,this.entities()[0].Id)},this).extend({throttle:1}),this.checkedEntities=r.computed(function(){return s.filter(this.entities(),function(t){return t.checked()},this)},this),this.hasCheckedEntities=r.computed(function(){return this.checkedEntities().length>0},this),this.deleteCommand=u.createCommand(this,this.deleteCheckedEntities,this.hasCheckedEntities),this.selectedCount=r.computed(function(){return this.checkedEntities().length},this),this.searchValue=r.observable(""),this.newSearchValue=r.observable(""),this.isSearchFocused=r.observable(!1),this.loading=r.observable(!1),this.searchText=r.computed(function(){return a.i18n("ADMINPANELWEBCLIENT/INFO_SEARCH_RESULT",{SEARCH:this.searchValue()})},this),this.oPageSwitcher=new l(0,N.EntitiesPerPage),this.oPageSwitcher.currentPage.subscribe(function(){this.requestEntities()},this),this.totalEntitiesCount.subscribe(function(){this.oPageSwitcher.setCount(this.totalEntitiesCount())},this),this.aIdListDeleteProcess=[],this.aAdditionalButtons=[],this.initAdditionalButtons()}var s=i(2),r=i(44),a=i(185),o=i(181),u=i(217),h=i(191),c=i(186),E=i(188),l=i(246),p=i(192),d=i(201),T=i(237),y=i(241),N=i(238);n.prototype.ViewTemplate="AdminPanelWebclient_EntitiesView",n.prototype.CreateFormViewTemplate="AdminPanelWebclient_EntityCreateFormView",n.prototype.onShow=function(){this.bShown=!0,this.requestEntities()},n.prototype.onHide=function(){this.bShown=!1},n.prototype.search=function(){this.oPageSwitcher.setPage(1,N.EntitiesPerPage),this.requestEntities()},n.prototype.clearSearch=function(){this.newSearchValue(""),this.requestEntities()},n.prototype.initFilters=function(){s.each(this.oEntityData.Filters,function(t){var e={list:r.computed(function(){var e=[];return s.isFunction(t.mList)?(e=t.mList(),s.isArray(e)||(e=[])):s.isArray(t.mList)&&(e=t.mList),e.length>0&&(t.sAllText&&e.unshift({text:t.sAllText,value:-1}),t.sNotInAnyText&&e.push({text:t.sNotInAnyText,value:0})),e},this),selectedValue:r.observable(-1),requestValue:r.observable(-1),sAllText:t.sAllText,sFileld:t.sField,sEntity:t.sEntity};e.selectedValue.subscribe(function(){e.sEntity?this.fChangeEntityHandler(e.sEntity,e.selectedValue()):e.requestValue(e.selectedValue())},this),e.requestValue.subscribe(function(){this.requestEntities()},this),this.aFilters.push(e)}.bind(this))},n.prototype.initAdditionalButtons=function(){s.each(this.oEntityData.AdditionalButtons,function(t){t&&t.ButtonView&&(s.isFunction(t.ButtonView.init)&&t.ButtonView.init(this.hasCheckedEntities,this.checkedEntities),this.aAdditionalButtons.push(t))}.bind(this))},n.prototype.requestEntities=function(){if(this.bShown&&("Tenant"===this.sType||o.isPositiveNumber(T.selectedTenantId()))){var t={TenantId:T.selectedTenantId(),Type:this.sType,Offset:(this.oPageSwitcher.currentPage()-1)*N.EntitiesPerPage,Limit:N.EntitiesPerPage,Search:this.newSearchValue()};s.each(this.aFilters,function(e){t[e.sFileld]=e.requestValue()}),this.searchValue(this.newSearchValue()),this.loading(!0),h.send(this.oEntityData.ServerModuleName,this.oEntityData.GetListRequest,t,function(t){if(this.loading(!1),t.Result){var e=s.isArray(t.Result.Items)?t.Result.Items:[],i=[],n=o.pInt(t.Result.Count);s.each(e,function(t){t&&t.Id&&(t.Id=o.pInt(t.Id),t.checked=r.observable(!1),t.trottleChecked=function(t,e){e.stopPropagation(),this.checked(!this.checked())},i.push(t))}),this.entities(i),this.totalEntitiesCount(n),0===this.entities().length?this.fChangeEntityHandler(this.sType,void 0,"create"):0!==this.justCreatedId()&&this.fChangeEntityHandler(this.sType,this.justCreatedId()),this.aIdListDeleteProcess=[]}else c.showErrorByCode(t),this.entities([])},this)}},n.prototype.setChangeEntityHandler=function(t){this.fChangeEntityHandler=t},n.prototype.changeEntity=function(t,e){s.each(this.aFilters,function(t){e[t.sEntity]?(t.selectedValue(e[t.sEntity]),t.requestValue(e[t.sEntity])):t.requestValue()===-1&&0===t.requestValue()||(t.selectedValue()===-1||0===t.selectedValue()?t.requestValue(t.selectedValue()):(t.selectedValue(-1),t.requestValue(-1)))}.bind(this)),this.current(o.pInt(t)),this.justCreatedId(0)},n.prototype.openCreateForm=function(){this.showCreateForm(!0),this.oEntityCreateView.clearFields()},n.prototype.cancelCreatingEntity=function(){this.showCreateForm(!1)},n.prototype.createEntity=function(){if(this.oEntityCreateView&&("Tenant"===this.sType||o.isPositiveNumber(T.selectedTenantId()))&&(!s.isFunction(this.oEntityCreateView.isValidSaveData)||this.oEntityCreateView.isValidSaveData())){var t=this.oEntityCreateView.getParametersForSave();t.TenantId=T.selectedTenantId(),this.isCreating(!0),h.send(this.oEntityData.ServerModuleName,this.oEntityData.CreateRequest,t,function(t){t.Result?(E.showReport(this.oEntityData.ReportSuccessCreateText),this.justCreatedId(o.pInt(t.Result)),this.oEntityCreateView.updateSavedState(),this.cancelCreatingEntity()):c.showErrorByCode(t,this.oEntityData.ErrorCreateText),this.requestEntities(),this.isCreating(!1)},this),this.oEntityCreateView.clearFields()}},n.prototype.deleteCurrentEntity=function(){this.deleteEntities([this.current()])},n.prototype.deleteCheckedEntities=function(){var t=s.map(this.checkedEntities(),function(t){return t.Id});this.deleteEntities(t)},n.prototype.deleteEntities=function(t){if(o.isNonEmptyArray(this.aIdListDeleteProcess)?(t=s.difference(t,this.aIdListDeleteProcess),this.aIdListDeleteProcess=s.union(t,this.aIdListDeleteProcess)):this.aIdListDeleteProcess=t,t.length>0){var e="",i=1===t.length?s.find(this.entities(),function(e){return e.Id===t[0]}):null;i&&(e=i.Name),p.showPopup(d,[a.i18n(this.oEntityData.ConfirmDeleteLangConst,{},null,t.length),s.bind(this.confirmedDeleteEntities,this,t),e,a.i18n("COREWEBCLIENT/ACTION_DELETE")])}},n.prototype.confirmedDeleteEntities=function(t,e){if(e&&o.isPositiveNumber(T.selectedTenantId())){var i={TenantId:T.selectedTenantId(),Type:this.sType,IdList:t};h.send(this.oEntityData.ServerModuleName,this.oEntityData.DeleteRequest,i,function(e){e.Result?E.showReport(a.i18n(this.oEntityData.ReportSuccessDeleteLangConst,{},null,t.length)):E.showError(a.i18n(this.oEntityData.ErrorDeleteLangConst,{},null,t.length)),this.requestEntities()},this)}else this.aIdListDeleteProcess=[]},n.prototype.groupCheck=function(){var t=!this.hasCheckedEntities();s.each(this.entities(),function(e){e.checked(t)})},t.exports=n},246:function(t,e,i){"use strict";function n(t,e){this.bShown=!1,this.currentPage=a.observable(1),this.count=a.observable(t),this.perPage=a.observable(e),this.firstPage=a.observable(1),this.lastPage=a.observable(1),this.pagesCount=a.computed(function(){var t=this.perPage()>0?Math.ceil(this.count()/this.perPage()):0;return t>0?t:1},this),a.computed(function(){var t=20,e=4,i=this.pagesCount(),n=this.currentPage(),s=n,r=n;if(i>1)for(;;){if(t--,1<s&&(s--,e--),0===e)break;if(i>r&&(r++,e--),0===e)break;if(0===t)break}this.firstPage(s),this.lastPage(r)},this),this.visibleFirst=a.computed(function(){return this.firstPage()>1},this),this.visibleLast=a.computed(function(){return this.lastPage()<this.pagesCount()},this),this.clickPage=s.bind(this.clickPage,this),this.pages=a.computed(function(){var t=this.firstPage(),e=[];if(this.firstPage()<this.lastPage())for(;t<=this.lastPage();t++)e.push({number:t,current:t===this.currentPage(),clickFunc:this.clickPage});return e},this),u.isMobile()||this.hotKeysBind()}var s=i(2),r=i(1),a=i(44),o=i(217),u=i(182);n.prototype.ViewTemplate="CoreWebclient_PageSwitcherView",n.prototype.hotKeysBind=function(){r(document).on("keydown",r.proxy(function(t){if(this.bShown&&!o.isTextFieldFocused()){var e=t.keyCode;t.ctrlKey&&e===Enums.Key.Left?this.clickPreviousPage():t.ctrlKey&&e===Enums.Key.Right&&this.clickNextPage()}},this))},n.prototype.hide=function(){this.bShown=!1},n.prototype.show=function(){this.bShown=!0},n.prototype.clear=function(){this.currentPage(1),this.count(0)},n.prototype.setCount=function(t){this.count(t),this.currentPage()>this.pagesCount()&&this.currentPage(this.pagesCount())},n.prototype.setPage=function(t,e){this.perPage(e),t>this.pagesCount()?this.currentPage(this.pagesCount()):this.currentPage(t)},n.prototype.clickPage=function(t){var e=t.number;e<1&&(e=1),e>this.pagesCount()&&(e=this.pagesCount()),this.currentPage(e)},n.prototype.clickFirstPage=function(){this.currentPage(1)},n.prototype.clickPreviousPage=function(){var t=this.currentPage()-1;t<1&&(t=1),this.currentPage(t)},n.prototype.clickNextPage=function(){var t=this.currentPage()+1;t>this.pagesCount()&&(t=this.pagesCount()),this.currentPage(t)},n.prototype.clickLastPage=function(){this.currentPage(this.pagesCount())},t.exports=n}});